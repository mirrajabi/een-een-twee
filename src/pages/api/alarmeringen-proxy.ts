import type { NextApiRequest, NextApiResponse } from "next";

// Hijacked from public session
const COOKIES =
  "euconsent-v2=CP0C_wAP0C_wAAGABCENAWEoAPLAAAAAABpYIzNBxDIUBQFCMXJ6SJswWIQX5kAAIiAQAAYBAyABhBoAIAQCkEESFATAAAACAAAAIAIAIABAGAAAAAAQQAABAAGASAAAgAIIICAAgAIBQAAIAAAAAAAAAAAAgAACAAAAkAAAAAIgWEgAFAAAAAAAIAgAAAABAgAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAABAAAAUEgMgALAAqAB4AEAAMgAaABEACYAE8AMwAbwA_ACEgEQARIApQBgADKgHcAd4A_QCUgI9AXmAyQBk4DPggAIAjgBOw0AEBnwiACAz4dAfAAWABUAEAAMgAaABEACYAE8AMQAZgA3gB-gEQARIApQBgADKAGjAO4A7wB-gEWAJSAc4A6gCLwEegJkAXmAyQBk4DLAGfDgBAA6ACEAERAI4ATsBMQDBAGTEoBwACwAiABMADFAIgAiQBgADvAOoAi8BHoC8wGSAMnAZ8SACADuAI4AmIBlhSA4AAsACoAIAAZAA0ACIAEwAJ4AYgAzAB-gEQARIApQBgADKAGiAO8AfoBFgCUgHUAReAj0BeYDJAGTgMsAZ8UACgDuALqAmIBggDJgAA.YAAAAAAAAAAA; consentUUID=6bcd6f60-cd65-4190-992d-eaa2f8fb4929_19_25; consentDate=2023-10-22T18:31:08.901Z; authId=5640d1f3-9542-460a-b023-dda986407489; _sp_ses.6f66=*; _ga=GA1.2.1486641541.1701458572; _gid=GA1.2.1130214996.1701458572; _pbjs_userid_consent_data=8586328867110083; _pubcid=672b386f-6333-4303-92cf-6904b15ea940; _sp_id.6f66=12af8c6a-4da2-4f1c-b4c9-8512ff9dc208.1697999177.14.1701459952.1698701371.84829874-7fc9-44be-b751-f93538862e2b; _gat=1; cto_bundle=gRW-ol9NYTZMQXpGc2VaRyUyQiUyQmpzZUVwM1NScUJ6OGJEWCUyRmlEV3M3WEg1JTJGMGlhdHMzU1JZVnpvd1pFWlY2Q3lMYzFxT01HVEd1ZGxMODhYSHBrNnU4TVQyU000enNmc3F1Rk5zY0ptQ3cyTnVQd21xRlNZM1RQcEVKdkhhaTNDclE0U3l3ZFV3dDhJdmR1WVpqTVNnN3A5V0lUbDhuT1B5d2Jra0hJZlg0JTJGbXBLUW9xa1hFbWVBJTJCYU13VzEzb1V5T1VFJTJGZWVkRE1rb1ROdVJwUXlWcENkSnRtV1ElM0QlM0Q; cto_bidid=V51MQV9paHQwZ1BLcWpDSnczOUdVakZIQ0xWRU5rVlNKckRPRmR6Ymt4eiUyQnElMkJibENXOFVlcFRvUHp2RVFZNlRhYXJ2dTFMTHBkUzdwcSUyRkZSaUhrSyUyQnNBNDN6T3ZrWUFGb1EySVllYU1qT3JqMWdnT2VKMXElMkI2ZU41Y0FrN29NJTJGb1RXZ3pPYXlRVnY5TTA4JTJCMGRtSHhTRWxuZyUzRCUzRA";

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse<string>
) {
  const proxyUrl = req.query.proxyUrl as string;
  return new Promise((resolve) => {
    fetch(proxyUrl, { headers: { Cookie: COOKIES } })
    .then((response) => response.text())
    .then((data) => {
      res.status(200).send(data);
      res.end();
      resolve(undefined);
    })
    .catch((error) => {
      console.error(error);
      res.status(400).end();
      resolve(undefined);
    });
  });
}
